(function(){"use strict";let c,u=new Uint8Array;function A(){return u.byteLength===0&&(u=new Uint8Array(c.memory.buffer)),u}let m=0;function p(e,t){const n=t(e.length*1);return A().set(e,n/1),m=e.length,n}let w=new Int32Array;function S(){return w.byteLength===0&&(w=new Int32Array(c.memory.buffer)),w}function M(e,t){return A().subarray(e/1,e/1+t)}function E(e,t,n,r,s,i){try{const f=c.__wbindgen_add_to_stack_pointer(-16),h=p(r,c.__wbindgen_malloc),g=m,z=p(s,c.__wbindgen_malloc),Z=m;c.derive(f,e,t,n,h,g,z,Z,i);var a=S()[f/4+0],o=S()[f/4+1],l=M(a,o).slice();return c.__wbindgen_free(a,o*1),l}finally{c.__wbindgen_add_to_stack_pointer(16)}}async function P(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function L(){const e={};return e.wbg={},e}function U(e,t){return c=e.exports,C.__wbindgen_wasm_module=t,w=new Int32Array,u=new Uint8Array,c}async function C(e){typeof e>"u"&&(e="/assets/scrypt_crate_bg.wasm");const t=L();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await P(await e,t);return U(n,r)}function I(e){if(/\s/.test(e))throw new Error("Can't contain whitespace");return e=e.replace(/(\w)-(\w)/g,(t,n,r)=>{const s=n.charCodeAt(0),i=r.charCodeAt(0);if(n.length!==1||s>255)throw new Error(`Invalid starting character in range "${t}"`);if(r.length!==1||i>255)throw new Error(`Invalid ending character in range "${t}"`);if(s>i)throw new Error(`Invalid range "${t}"`);let a="";for(let o=s;o<=i;o++)a+=String.fromCharCode(o);return a}),e.replace(/[^\\]-|[^\\]-\W|^-\W|^-\w?/,t=>{throw new Error(`Unterminated range "${t}"`)}),e=e.replace(/\\(.)/g,"$1"),Array.from(new Set(e.split(""))).sort()}const _={allowedChars:"a-zA-Z0-9_.",requiredChars:"",passwordLen:24};function T({union:e,passwordLen:t}){return Math.ceil(Math.log2(e.length)*t)}function q({allowedChars:e,requiredChars:t,passwordLen:n}){return e===_.allowedChars&&t===_.requiredChars&&n===_.passwordLen}function O(e){let t="";for(let n=0;n<e.length;n++){let r=e[n].toString(16);r.length<2&&(r="0"+r),t+=r}return t}const $=C(),d=new TextEncoder,v=8,R=32768,W=4,b=32,Y=64,B=d.encode("derivepass/aes");function D(e,{required:t,passwordLen:n,allowed:r,union:s}){const i=new Uint8Array([...e].reverse());let a=BigInt("0x"+O(i));const o=new Set(t);let l="";for(;l.length<n;){let f;o.size===0?f=r:o.size===n-l.length?f=Array.from(o):f=s;const h=BigInt(f.length),g=f[Number(a%h)];a=a/h,o.delete(g),l+=g}return l}const K=18,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_.".split("");function N(e){if(e.length!==K)throw new Error("Invalid raw bytes");let t="";for(let n=0;n<e.length;n+=3){const r=e[n],s=e[n+1],i=e[n+2];t+=y[r>>>2],t+=y[(r&3)<<4|s>>>4],t+=y[(s&15)<<2|i>>>6],t+=y[i&63]}return t}function k({master:e},t){const n=`${t.domain}/${t.login}${t.revision>1?`#${t.revision}`:""}`,r=I(t.allowedChars),s=I(t.requiredChars),i=[...new Set([...r,...s])].sort(),a={allowed:r,required:s,union:i,passwordLen:t.passwordLen},o=Math.ceil(T(a)/8),l=E(v,R,W,d.encode(e),d.encode(n),o);return q(t)?N(l):D(l,a)}function x(e){const t=E(v,R,W,d.encode(e),B,b+Y);return{master:e,aes:t.slice(0,b),hmac:t.slice(b)}}onmessage=async e=>{await $;const t=e.data;let n;t.type==="computeKeys"?n={type:"computeKeys",result:x(t.master)}:n={type:"computePassword",result:k(t.keys,t.app)},postMessage(n)}})();
//# sourceMappingURL=worker.9e190674.js.map